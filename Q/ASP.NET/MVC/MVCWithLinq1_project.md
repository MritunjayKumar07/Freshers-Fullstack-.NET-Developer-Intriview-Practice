## Q. How can I Read operations for the Student model in this ASP.NET MVC application, ensuring the use of LINQ to interact with the database effectively?

1. Open Visual Studio;
2. Create project name it `MVCWithLinq1` use MVC;
3. Select `Models` > `Add` > click on `New Item` > `Data` (LHS side) > `LINK to SQL Classes` > Name it and press `ok`.
4. Open `MVCDB.dbml` next Open `Server Explorer` Add new connection and select table and drag and drop the table into left side of `MVCDB.dbml`.
5. Create the Controllers name is `StudentController.cs`.

## Read all data from database:

6. Create the `StudentDAL` class in Models class:

StudentDAL.cs:

```c#
using System.Collections.Generic;
using System.Linq;
using System.Configuration; //For MVCDBDataContext > ConfigurationManager

namespace MVCWithLinq1.Models
{
    public class StudentDAL
    {
        MVCDBDataContext db = new MVCDBDataContext(ConfigurationManager.ConnectionStrings["MVCDBConnectionString"].ConnectionString); //By using this instance of MVCDBDataContext class use to connect the database (ORM-> LINK to SQL)

        public List<Student> GetStudents(bool? status)
        {
            List<Student> students;

            if (status != null)
                students = (from s in db.Students where s.Status == status select s).ToList();
            else
                students = (from s in db.Students select s).ToList();
            return students;
        }
    }
}
```

StudentController.cs:

```c#
using MVCWithLinq1.Models;
using System.Web.Mvc;

namespace MVCWithLinq1.Controllers
{
    public class StudentController : Controller
    {
        StudentDAL obj = new StudentDAL();
        public ViewResult ShowStudents()
        {
            return View(obj.GetStudents(true));
        }
    }
}
```

ShowStudents.cshtml:

```html
@model IEnumerable<MVCWithLinq1.Models.Student>
  @{ ViewBag.Title = "ShowStudents"; }

  <h2>ShowStudents</h2>

  <table class="table">
    <thead>
      <tr>
        <th>@Html.DisplayNameFor(S => S.Sid)</th>
        <th>@Html.DisplayNameFor(S => S.Name)</th>
        <th>@Html.DisplayNameFor(S => S.Fees)</th>
        <th>@Html.DisplayNameFor(S => S.Class)</th>
        <th>@Html.DisplayNameFor(S => S.Photo)</th>
        <th>Action's'</th>
      </tr>
    </thead>
    <tbody>
      @foreach(MVCWithLinq1.Models.Student student in Model) {
      <tr>
        <td>@Html.DisplayFor(S => student.Sid)</td>
        <td>@Html.DisplayFor(S => student.Name)</td>
        <td>@Html.DisplayFor(S => student.Fees)</td>
        <td>@Html.DisplayFor(S => student.Class)</td>
        <td>@Html.DisplayFor(S => student.Photo)</td>
        <td>
          @Html.ActionLink("View", "ShowStudent", new { Sid = student.Sid })
          <!-- Sid = student.Sid: Sid name same as parameter of method -->
        </td>
      </tr>
      }
    </tbody>
  </table></MVCWithLinq1.Models.Student
>
```

Explain to Get data:

### 1. `MVCDBDataContext db = new MVCDBDataContext(ConfigurationManager.ConnectionStrings["MVCDBConnectionString"].ConnectionString);`

This line initializes a new instance of the `MVCDBDataContext` class, which represents the database context for connecting to the database.

- **`MVCDBDataContext`**: This is a class generated by LINQ to SQL or Entity Framework that handles the connection to the database and allows you to query and manage the data.
- **`ConfigurationManager.ConnectionStrings["MVCDBConnectionString"].ConnectionString`**: This retrieves the connection string named "MVCDBConnectionString" from the application's configuration file (`web.config`). The connection string contains the information needed to connect to the database, such as the server name, database name, and authentication details.

### 2. `List<Student> students;`

This line declares a list of `Student` objects.

- **`List<Student>`**: This is a generic list that will hold objects of type `Student`. `List` is a collection type in C# that allows you to store and manage a list of objects.
- **`students`**: This is the variable name for the list. Later in the code, this list is populated with student records retrieved from the database.

### 3. `StudentDAL obj = new StudentDAL();`

This line creates an instance of the `StudentDAL` class.

- **`StudentDAL`**: This is a Data Access Layer class that is used to interact with the database and fetch data related to the `Student` entity.
- **`obj`**: This is the variable name for the `StudentDAL` instance. It allows the controller to call methods from the `StudentDAL` class, like `GetStudents`.

### 4. `@model IEnumerable<MVCWithLinq1.Models.Student>`

This line at the top of the Razor view specifies the model type that the view expects.

- **`@model`**: A directive used in ASP.NET MVC Razor views to define the type of the data (model) that the view will use.
- **`IEnumerable<MVCWithLinq1.Models.Student>`**: This means the view will work with a collection of `Student` objects (from the namespace `MVCWithLinq1.Models`). `IEnumerable` is a base interface for collections in .NET that allows simple iteration over a collection.

### 5. `@{ ViewBag.Title = "ShowStudents"; }`

This line sets the title of the webpage.

- **`ViewBag.Title`**: `ViewBag` is a dynamic object in ASP.NET MVC used to pass data from the controller to the view. Here, it sets the page's title to "ShowStudents".

### 6. `@Html.DisplayNameFor(S => S.Sid)` (and similar lines for other fields)

These lines are used to display the column headers in the HTML table.

- **`@Html.DisplayNameFor`**: A helper method in ASP.NET MVC that generates the display name (label) for a model property. It uses metadata or property names to generate the label.
- **`S => S.Sid`**: A lambda expression that specifies the property (`Sid`, `Name`, `Fees`, `Class`, `Photo`) of the `Student` model for which the display name should be generated.

### 7. `@foreach(MVCWithLinq1.Models.Student student in Model) { ... }`

This loop iterates through the collection of `Student` objects passed to the view.

- **`@foreach`**: A Razor syntax to loop over each item in a collection.
- **`MVCWithLinq1.Models.Student student`**: This defines the loop variable `student` of type `Student` for each iteration. The `Model` keyword refers to the collection of `Student` objects passed to the view.

### 8. `MVCWithLinq1.Models.Student student in Model`

This part of the `foreach` loop statement specifies the type and variable name for each item being iterated over.

- **`MVCWithLinq1.Models.Student`**: Specifies that each item in the collection (`Model`) is of type `Student` (from the namespace `MVCWithLinq1.Models`).
- **`student`**: The loop variable that represents the current `Student` object in each iteration.

### 9. `MVCWithLinq1.Models.Student student`

This is a declaration of a variable named `student` of type `Student`.

- **`MVCWithLinq1.Models.Student`**: Indicates the type of the `student` variable, which is a `Student` object from the namespace `MVCWithLinq1.Models`.
- **`student`**: The variable name used to reference each individual student object in the loop.

### Summary

The provided code defines a basic MVC structure that uses a Data Access Layer (`StudentDAL`) to fetch student data from a database, a controller (`StudentController`) to handle the logic, and a Razor view to display the student data in an HTML table.

7. Create the `StudentDAL` class in Models class:

## Read single data from database:


StudentDAL.cs:

```c#
using System.Collections.Generic;
using System.Linq;
using System.Configuration; //For MVCDBDataContext > ConfigurationManager

namespace MVCWithLinq1.Models
{
    public class StudentDAL
    {
        MVCDBDataContext db = new MVCDBDataContext(ConfigurationManager.ConnectionStrings["MVCDBConnectionString"].ConnectionString); //By using this instance of MVCDBDataContext class use to connect the database (ORM-> LINK to SQL)

        public Student GetStudent(int id, bool? status)
        {
            Student student;
            if (status == null)
                student = (from s in db.Students where s.Sid == id select s).Single();
            else
                student = (from s in db.Students where s.Sid == id && s.Status == status select s).Single();
            return student;
        }
    }
}
```

StudentController.cs:

```c#
using MVCWithLinq1.Models;
using System.Web.Mvc;

namespace MVCWithLinq1.Controllers
{
    public class StudentController : Controller
    {
        StudentDAL obj = new StudentDAL();
        public ViewResult ShowStudent(int Sid, bool? Status)
        {
            return View(obj.GetStudent(Sid, true));
        }
    }
}

```

ShowStudent.cshtml:

```html
@model MVCWithLinq1.Models.Student @{ ViewBag.Title = "ShowStudent"; }

<h2>ShowStudent</h2>

@Html.DisplayNameFor(S => S.Sid) @Html.DisplayFor(S => S.Sid)
<br />

@Html.DisplayNameFor(S => S.Name) @Html.DisplayFor(S => S.Name)
<br />

@Html.DisplayNameFor(S => S.Class) @Html.DisplayFor(S => S.Class)
<br />

@Html.DisplayNameFor(S => S.Fees) @Html.DisplayFor(S => S.Fees)
<br />

@Html.DisplayNameFor(S => S.Photo)
<img src="~/Uploads/@Model.Photo" width="250px" height="250px" alt="@Model.Photo"/>

```

## Add data in database:

StudentDAL.cs:

```c#
using System.Collections.Generic;
using System.Linq;
using System.Configuration; //For MVCDBDataContext > ConfigurationManager

namespace MVCWithLinq1.Models
{
    public class StudentDAL
    {
        MVCDBDataContext db = new MVCDBDataContext(ConfigurationManager.ConnectionStrings["MVCDBConnectionString"].ConnectionString); //By using this instance of MVCDBDataContext class use to connect the database (ORM-> LINK to SQL)

        public void AddStudent(Student student)
        {
            db.Students.InsertOnSubmit(student);
            db.SubmitChanges();
        }
    }
}
```

StudentController.cs:

```c#
using MVCWithLinq1.Models;
using System.Web.Mvc;

namespace MVCWithLinq1.Controllers
{
    public class StudentController : Controller
    {
        StudentDAL obj = new StudentDAL();

        [HttpGet]
        public ViewResult AddStudent()
        {
            return View();
        }

        [HttpPost]
        public RedirectToRouteResult AddStudent(Student student, HttpPostedFileBase selectedFile)
        {
            if (selectedFile != null)
            {
                //Checking whether the folder "Uploads" is exists or not and creating it if not exists
                string PhysicalPath = Server.MapPath("~/Uploads/");
                if (!Directory.Exists(PhysicalPath))
                {
                    Directory.CreateDirectory(PhysicalPath);
                }
                selectedFile.SaveAs(PhysicalPath + selectedFile.FileName);
                student.Photo = selectedFile.FileName;
            }
            student.Status = true;
            obj.AddStudent(student);
            return RedirectToAction("ShowStudents");
        }
    }
}

```

AddStudent.cshtml:

```html
@model MVCWithLinq1.Models.Student @{ ViewBag.Title = "AddStudent"; }

<h2>AddStudent</h2>

@using (Html.BeginForm("AddStudent", "Student", FormMethod.Post, new { enctype =
"multipart/form-data" })) {
<div>@Html.LabelFor(S => S.Sid)<br />@Html.TextBoxFor(S => S.Sid)</div>
<div>@Html.LabelFor(S => S.Name)<br />@Html.TextBoxFor(S => S.Name)</div>
<div>@Html.LabelFor(S => S.Class)<br />@Html.TextBoxFor(S => S.Class)</div>
<div>@Html.LabelFor(S => S.Fees)<br />@Html.TextBoxFor(S => S.Fees)</div>
<div>
  @Html.LabelFor(S => S.Photo)<br /><input type="file" name="selectedFile" />
</div>
<div>
  <input type="submit" value="Save" />
</div>
} @Html.ActionLink("Back to Student Details", "DisplayStudents")
```

Explain to add data:

### 1. `<img src='/Uploads/@student.Photo' width="40" height="25" alt="No Image" />`

- This is an HTML tag that displays an image.
- `src` specifies the source of the image file, which is located in the "Uploads" folder.
- `@student.Photo` dynamically inserts the filename stored in the `Photo` property of the `student` object.
- `width` and `height` set the dimensions of the displayed image.
- `alt` provides alternate text ("No Image") to be shown if the image cannot be loaded.

### 2. `@foreach (MVCWithLinq1.Models.Student student in Model)`

- This is a loop in Razor syntax (used in ASP.NET MVC views).
- `@foreach` iterates over each `Student` object in the `Model` collection.
- `Model` is expected to be an `IEnumerable<Student>` type, containing a list of students.
- For every iteration, it assigns a `Student` object to the variable `student`.

### 3. `Student student, HttpPostedFileBase selectedFile`

- These are parameters of the `[HttpPost]` method `AddStudent`.
- `Student student` is an object representing a student's details (like Name, Fees, Class, etc.).
- `HttpPostedFileBase selectedFile` represents the file uploaded by the user, such as an image or document.
- `HttpPostedFileBase` is used to handle file uploads in ASP.NET MVC.

### 4. `string PhysicalPath = Server.MapPath("~/Uploads/");`

- This line converts a relative virtual path (like `~/Uploads/`) to a physical file system path on the server.
- `Server.MapPath("~/Uploads/")` gets the absolute path to the "Uploads" directory on the server where the uploaded files will be stored.
- `PhysicalPath` stores this converted path.

### 5. `Directory.CreateDirectory(PhysicalPath);`

- This line checks if the directory specified by `PhysicalPath` exists.
- If the directory does not exist, it creates it.
- Ensures that the "Uploads" folder exists before trying to save a file into it.

### 6. `selectedFile.SaveAs(PhysicalPath + selectedFile.FileName);`

- This line saves the uploaded file to the "Uploads" folder on the server.
- `selectedFile.FileName` is the name of the uploaded file.
- `PhysicalPath + selectedFile.FileName` concatenates the directory path with the file name to get the full path where the file will be saved.

### 7. `student.Photo = selectedFile.FileName;`

- This assigns the file name of the uploaded image to the `Photo` property of the `student` object.
- This allows you to store just the file name in the database, rather than the full path.
- Later, this file name is used to display the image on the web page.

### 8. `student.Status = true;`

- Sets the `Status` property of the `student` object to `true`.
- This might indicate that the student record is active or valid.
- It's a flag to determine the student's status in the system.

### 9. `db.Students.InsertOnSubmit(student);`

- This line prepares the `student` object to be inserted into the `Students` table in the database.
- `InsertOnSubmit` is a method used in LINQ to SQL to mark the object for insertion when `SubmitChanges()` is called.

### 10. `db.SubmitChanges();`

- This method executes all pending changes to the database.
- In this case, it inserts the new `student` record into the `Students` table.
- `SubmitChanges()` is required to save the changes made by `InsertOnSubmit`.

### Summary of Workflow:

1. **Form Submission**: The user submits the form with student details and optionally uploads a file.
2. **Folder Check and File Save**: The server checks if the "Uploads" folder exists and saves the uploaded file.
3. **Student Object Update**: The `student` object is updated with the uploaded file name and status.
4. **Database Insert**: The new `student` object is added to the database and changes are saved.
5. **View Update**: The user is redirected to the "ShowStudents" view where the updated list of students, including the new one, is displayed.


## Delete data in database:

StudentDAL.cs:

```c#
using System.Collections.Generic;
using System.Linq;
using System.Configuration; //For MVCDBDataContext > ConfigurationManager

namespace MVCWithLinq1.Models
{
    public class StudentDAL
    {
        MVCDBDataContext db = new MVCDBDataContext(ConfigurationManager.ConnectionStrings["MVCDBConnectionString"].ConnectionString); //By using this instance of MVCDBDataContext class use to connect the database (ORM-> LINK to SQL)

        public void DeleteStudent(int Sid, bool del)
        {
            Student oldValues = db.Students.First(S=>S.Sid == Sid);
            if (del == true)
                db.Students.DeleteOnSubmit(oldValues);
            else
                oldValues.Status = false;
            db.SubmitChanges();
        }
    }
}
```

StudentController.cs:

```c#
using MVCWithLinq1.Models;
using System.Web.Mvc;

namespace MVCWithLinq1.Controllers
{
    public class StudentController : Controller
    {
        StudentDAL obj = new StudentDAL();

        public RedirectToRouteResult RemoveStudent(int Sid, bool del)
        {
            obj.DeleteStudent(Sid, del);
            return RedirectToAction("ShowStudents");
        }
    }
}

```

ShowStudents.cshtml:

```html
@model IEnumerable<MVCWithLinq1.Models.Student>

@{
    ViewBag.Title = "ShowStudents";
}

<h2>ShowStudents</h2>

<table class="table">
    <thead>
        <tr>
            <th>@Html.DisplayNameFor(S => S.Sid)</th>
            <th>@Html.DisplayNameFor(S => S.Name)</th>
            <th>@Html.DisplayNameFor(S => S.Fees)</th>
            <th>@Html.DisplayNameFor(S => S.Class)</th>
            <th>@Html.DisplayNameFor(S => S.Photo)</th>
            <th>Action's'</th>
        </tr>
    </thead>
    <tbody>
        @foreach (MVCWithLinq1.Models.Student student in Model)
        {
            <tr>
                <td>@Html.DisplayFor(S => student.Sid)</td>
                <td>@Html.DisplayFor(S => student.Name)</td>
                <td>@Html.DisplayFor(S => student.Fees)</td>
                <td>@Html.DisplayFor(S => student.Class)</td>
                <th><img src='/Uploads/@student.Photo' width="40" height="25" alt="No Image" /></th>
                <td>
                    @Html.ActionLink("View", "ShowStudent", new { Sid = student.Sid }) @*Sid = student.Sid: Sid name same as parameter of method*@
                    @Html.ActionLink("Temporary delete", "RemoveStudent", new { Sid = student.Sid, del = false }, new {onclick= "return confirm('Do you realy want to delete this student temporary?')" }) 
                    @Html.ActionLink("Permanently delete", "RemoveStudent", new { Sid = student.Sid, del = true }, new { onclick = "return confirm('Do you realy want to delete this student permenantly?')" }) 
                </td>
            </tr>
         }
    </tbody>
</table>
@Html.ActionLink("Add Student's", "AddStudent")

```

Explain to Delete data:

### 1. **StudentDAL.cs** (Data Access Layer)

- **`Student oldValues = db.Students.First(S => S.Sid == Sid);`**
  - This line retrieves the first `Student` object from the `db.Students` collection where the `Sid` (Student ID) matches the `Sid` passed as a parameter to the `DeleteStudent` method.
  - The `First` method is a LINQ (Language Integrated Query) method that returns the first element that satisfies the given condition. If no student matches the ID, it will throw an exception.

- **`if (del == true) db.Students.DeleteOnSubmit(oldValues);`**
  - This `if` statement checks whether the `del` parameter is `true`.
  - If `del` is `true`, it calls `DeleteOnSubmit` on the `db.Students` table with `oldValues` (the `Student` object found earlier) as an argument.
  - This means the student will be **permanently removed** from the database when `SubmitChanges` is called.

- **`else oldValues.Status = false;`**
  - If `del` is `false`, instead of deleting the student, it sets the `Status` property of the `Student` object (`oldValues`) to `false`.
  - This is a way to **temporarily delete** or deactivate the student without removing their record from the database.
  
- **`db.SubmitChanges();`**
  - This line saves all the changes made to the database.
  - Whether the student is permanently deleted or just deactivated, this line is necessary to commit those changes to the database.

### 2. **StudentController.cs** (Controller)

- **`public RedirectToRouteResult RemoveStudent(int Sid, bool del)`**
  - This method is in the `StudentController` class and it handles the request to remove a student.
  - It takes two parameters: `Sid` (the student ID) and `del` (a boolean indicating whether the deletion is permanent).
  - Inside, it calls the `DeleteStudent` method from the `StudentDAL` class with these parameters.

- **`return RedirectToAction("ShowStudents");`**
  - After performing the delete or deactivate operation, this line redirects the user to the "ShowStudents" action, which displays the list of students.

### 3. **ShowStudents.cshtml** (View)

- **`@Html.ActionLink("Temporary delete", "RemoveStudent", new { Sid = student.Sid, del = false }, new { onclick = "return confirm('Do you really want to delete this student temporarily?')" })`**
  - This line creates an HTML link that allows the user to **temporarily delete** (deactivate) a student.
  - `@Html.ActionLink` is a helper method that generates a link to a specific action method in the controller.
  - `"Temporary delete"` is the text shown on the link.
  - `"RemoveStudent"` is the name of the action method in the `StudentController`.
  - `new { Sid = student.Sid, del = false }` creates a set of parameters to pass to the `RemoveStudent` action; `Sid` is the ID of the student, and `del` is set to `false` to indicate a temporary deletion.
  - `new { onclick = "return confirm('Do you really want to delete this student temporarily?')" }` adds an `onclick` event to the link that displays a confirmation dialog before proceeding with the action.

- **`@Html.ActionLink("Permanently delete", "RemoveStudent", new { Sid = student.Sid, del = true }, new { onclick = "return confirm('Do you really want to delete this student permanently?')" })`**
  - Similar to the "Temporary delete" link, this line creates an HTML link for **permanently deleting** a student.
  - `"Permanently delete"` is the text shown on the link.
  - `"RemoveStudent"` is the action method in the controller.
  - `new { Sid = student.Sid, del = true }` passes the parameters to the `RemoveStudent` action; `Sid` is the student's ID, and `del` is set to `true` for permanent deletion.
  - The `onclick` attribute adds a confirmation dialog to ensure the user wants to proceed with the permanent deletion.

### Additional Important Points:

- **Data Access Layer (DAL):**
  - The `StudentDAL` class acts as a bridge between the database and the controller, encapsulating all the logic required to interact with the `Students` table. It uses LINQ to SQL (`MVCDBDataContext`) for querying and modifying data.

- **Confirmation Messages in Views:**
  - Using `onclick` for confirmation prompts in the view helps prevent accidental deletions by asking the user to confirm their actions before proceeding.

- **Using Redirect in Controller:**
  - The `RedirectToAction("ShowStudents")` method call in the `RemoveStudent` action ensures that after any action is taken (temporary or permanent deletion), the user is redirected back to the list of students. This keeps the user experience consistent and provides immediate feedback on the action taken.


## Update data in database

StudentDAL.cs:

```c#
using System.Collections.Generic;
using System.Linq;
using System.Configuration; //For MVCDBDataContext > ConfigurationManager

namespace MVCWithLinq1.Models
{
    public class StudentDAL
    {
        MVCDBDataContext db = new MVCDBDataContext(ConfigurationManager.ConnectionStrings["MVCDBConnectionString"].ConnectionString); //By using this instance of MVCDBDataContext class use to connect the database (ORM-> LINK to SQL)

        public void EditStudent(Student student) 
        {
            Student oldValues = db.Students.First(S => S.Sid == student.Sid);
            oldValues.Name = student.Name;
            oldValues.Fees = student.Fees;
            oldValues.Class = student.Class;
            oldValues.Photo = student.Photo;
            db.SubmitChanges();
        }
    }
}
```

StudentController.cs:

```c#
using MVCWithLinq1.Models;
using System.Web.Mvc;

namespace MVCWithLinq1.Controllers
{
    public class StudentController : Controller
    {
        StudentDAL obj = new StudentDAL();

        [HttpGet]
        public ViewResult UpdateStudent(int Sid)
        {
            Student student = obj.GetStudent(Sid, true);
            return View(student);
        }

        [HttpPost]
        public RedirectToRouteResult UpdateStudent(Student student, HttpPostedFileBase selectedFile)
        {
            if (selectedFile != null)
            {
                string PhysicalPath = Server.MapPath("~/Uploads/");

                if (!Directory.Exists(PhysicalPath))
                    Directory.CreateDirectory(PhysicalPath);

                selectedFile.SaveAs(PhysicalPath + selectedFile.FileName);
                student.Photo = selectedFile.FileName;
            }

            obj.EditStudent(student);
            return RedirectToAction("ShowStudents");
        }
    }
}

```

UpdateStudent.cshtml:

```html
@model MVCWithLinq1.Models.Student
@{
    ViewBag.Title = "UpdateStudent";
}

<h2>UpdateStudent</h2>

@using (Html.BeginForm("UpdateStudent", "Student", FormMethod.Post, new { enctype ="multipart/form-data"}))
{
    <div>@Html.LabelFor(S => S.Sid)<br />@Html.TextBoxFor(S => S.Sid, new { @readOnly = true })</div>
    <div>@Html.LabelFor(S => S.Name)<br />@Html.TextBoxFor(S => S.Name)</div>
    <div>@Html.LabelFor(S => S.Class)<br />@Html.TextBoxFor(S => S.Class)</div>
    <div>@Html.LabelFor(S => S.Fees)<br />@Html.TextBoxFor(S => S.Fees)</div>
    <div>
        @Html.LabelFor(S => S.Photo)<br />
        <img src="~/Uploads/@Model.Photo" width="250px" height="250px" alt="@Model.Photo"/>
        <input type="file" name="selectedFile"/>
    </div>
    <div>
        <input type="submit" value="Update" />
    </div>
} 

@Html.ActionLink("Back to Student Details", "DisplayStudents")

```

Explain to Delete data:
- `Student student = obj.GetStudent(Sid, true);`
    - Retrieves the Student object with the given Sid using the GetStudent method of the StudentDAL class.
    - The true parameter might indicate whether to include related data or perform additional operations, but it depends on the implementation of GetStudent (not provided in your code).

- `return View(student);`
    - Returns the UpdateStudent view with the Student object passed as the model.
    - This model will be used to populate the form fields with the existing data for the student.


## CRUD with data in database

1. Create MVC Project in Visual Studio name it `MVCWithLinq1`.
2. Add MVCDB database and Student table in SQL. 
3. In MVC Projectand add LINQ to SQL and name it `MVCDB`.
4. Create `Uploads` folder in `MVCWithLinq1` project.
5. Next create `StudentDAL.cs` in `Models` folder. 

StudentDAL.cs :-

```C#
using System.Collections.Generic;
using System.Linq;
using System.Configuration;
using System.Data.OleDb;
using System.Security.Cryptography;

namespace MVCWithLinq1.Models
{
    public class StudentDAL
    {
        MVCDBDataContext db = new MVCDBDataContext(ConfigurationManager.ConnectionStrings["MVCDBConnectionString"].ConnectionString);

        public List<Student> GetStudents(bool? status)
        {
            List<Student> students;

            if (status != null)
                students = (from s in db.Students where s.Status == status select s).ToList();
            else
                students = (from s in db.Students select s).ToList();
            return students;
        }

        public Student GetStudent(int id, bool? status)
        {
            Student student;
            if (status == null)
                student = (from s in db.Students where s.Sid == id select s).Single();
            else
                student = (from s in db.Students where s.Sid == id && s.Status == status select s).Single();
            return student;
        }

        public void AddStudent(Student student)
        {
            db.Students.InsertOnSubmit(student);
            db.SubmitChanges();
        }

        public void DeleteStudent(int Sid, bool del)
        {
            Student oldValues = db.Students.First(S=>S.Sid == Sid);
            if (del == true)
                db.Students.DeleteOnSubmit(oldValues);
            else
                oldValues.Status = false;
            db.SubmitChanges();
        }

        public void EditStudent(Student student) 
        {
            Student oldValues = db.Students.First(S => S.Sid == student.Sid);
            oldValues.Name = student.Name;
            oldValues.Fees = student.Fees;
            oldValues.Class = student.Class;
            oldValues.Photo = student.Photo;
            db.SubmitChanges();
        }
    }
}
```

6. And create the `StudentController.cs` in Controller folder and create all controller all code is below:

StudentController.cs :- 

```C#
using MVCWithLinq1.Models;
using System.IO;
using System.Web;
using System.Web.Mvc;

namespace MVCWithLinq1.Controllers
{
    public class StudentController : Controller
    {
        StudentDAL obj = new StudentDAL();
        public ViewResult ShowStudents()
        {
            return View(obj.GetStudents(true));
        }

        public ViewResult ShowStudent(int Sid, bool? Status)
        {
            return View(obj.GetStudent(Sid, true));
        }

        [HttpGet]
        public ViewResult AddStudent()
        {
            return View();
        }

        [HttpPost]
        public RedirectToRouteResult AddStudent(Student student, HttpPostedFileBase selectedFile)
        {
            if (selectedFile != null)
            {
                string PhysicalPath = Server.MapPath("~/Uploads/");
                if (!Directory.Exists(PhysicalPath))
                {
                    Directory.CreateDirectory(PhysicalPath);
                }
                selectedFile.SaveAs(PhysicalPath + selectedFile.FileName);
                student.Photo = selectedFile.FileName;
            }
            
            student.Status = true;
            obj.AddStudent(student);
            return RedirectToAction("ShowStudents");
        }

        public RedirectToRouteResult RemoveStudent(int Sid, bool del)
        {
            obj.DeleteStudent(Sid, del);
            return RedirectToAction("ShowStudents");
        }

        [HttpGet]
        public ViewResult UpdateStudent(int Sid)
        {
            Student student = obj.GetStudent(Sid, true);
            return View(student);
        }

        [HttpPost]
        public RedirectToRouteResult UpdateStudent(Student student, HttpPostedFileBase selectedFile)
        {
            if (selectedFile != null)
            {
                string PhysicalPath = Server.MapPath("~/Uploads/");

                if (!Directory.Exists(PhysicalPath))
                    Directory.CreateDirectory(PhysicalPath);

                selectedFile.SaveAs(PhysicalPath + selectedFile.FileName);
                student.Photo = selectedFile.FileName;
            }

            obj.EditStudent(student);
            return RedirectToAction("ShowStudents");
        }
    }
}

```

7. Create `Layout page Views` :-

AddStudent.cshtml :-

```html
@model MVCWithLinq1.Models.Student
@{
    ViewBag.Title = "AddStudent";
}

<h2>AddStudent</h2>

@using (Html.BeginForm("AddStudent", "Student", FormMethod.Post, new { enctype = "multipart/form-data" }))
{
    <div>@Html.LabelFor(S => S.Sid)<br />@Html.TextBoxFor(S => S.Sid)</div>
    <div>@Html.LabelFor(S => S.Name)<br />@Html.TextBoxFor(S => S.Name)</div>
    <div>@Html.LabelFor(S => S.Class)<br />@Html.TextBoxFor(S => S.Class)</div>
    <div>@Html.LabelFor(S => S.Fees)<br />@Html.TextBoxFor(S => S.Fees)</div>
    <div>@Html.LabelFor(S => S.Photo)<br /><input type="file" name="selectedFile" /></div>
    <div>
        <input type="submit" value="Save" />
    </div>
}


@Html.ActionLink("Back to Student Details", "DisplayStudents")
```

ShowStudent.cshtml:-

```html
@model MVCWithLinq1.Models.Student

@{
    ViewBag.Title = "ShowStudent";
}

<h2>ShowStudent</h2>

@Html.DisplayNameFor(S => S.Sid)
@Html.DisplayFor(S => S.Sid)
<br/>

@Html.DisplayNameFor(S => S.Name)
@Html.DisplayFor(S => S.Name)
<br />

@Html.DisplayNameFor(S => S.Class)
@Html.DisplayFor(S => S.Class)
<br />

@Html.DisplayNameFor(S => S.Fees)
@Html.DisplayFor(S => S.Fees)
<br />

@Html.DisplayNameFor(S => S.Photo)
<img src="~/Uploads/@Model.Photo" width="250px" height="250px" alt="@Model.Photo"/>

```

ShowStudents.cshtml :-

```sql
@model IEnumerable<MVCWithLinq1.Models.Student>

@{
    ViewBag.Title = "ShowStudents";
}

<h2>ShowStudents</h2>

<table class="table">
    <thead>
        <tr>
            <th>@Html.DisplayNameFor(S => S.Sid)</th>
            <th>@Html.DisplayNameFor(S => S.Name)</th>
            <th>@Html.DisplayNameFor(S => S.Fees)</th>
            <th>@Html.DisplayNameFor(S => S.Class)</th>
            <th>@Html.DisplayNameFor(S => S.Photo)</th>
            <th>Action's'</th>
        </tr>
    </thead>
    <tbody>
        @foreach (MVCWithLinq1.Models.Student student in Model)
        {
            <tr>
                <td>@Html.DisplayFor(S => student.Sid)</td>
                <td>@Html.DisplayFor(S => student.Name)</td>
                <td>@Html.DisplayFor(S => student.Fees)</td>
                <td>@Html.DisplayFor(S => student.Class)</td>
                <th><img src='/Uploads/@student.Photo' width="40" height="25" alt="No Image" /></th>
                <td>
                    @Html.ActionLink("View", "ShowStudent", new { Sid = student.Sid }) @*Sid = student.Sid: Sid name same as parameter of method*@ |
                    @Html.ActionLink("Update", "UpdateStudent", new { Sid = student.Sid }) |
                    @Html.ActionLink("Temporary delete", "RemoveStudent", new { Sid = student.Sid, del = false }, new { onclick = "return confirm('Do you realy want to delete this student temporary?')" })  |
                    @Html.ActionLink("Permanently delete", "RemoveStudent", new { Sid = student.Sid, del = true }, new { onclick = "return confirm('Do you realy want to delete this student permenantly?')" })
                </td>
            </tr>
         }
    </tbody>
</table>
@Html.ActionLink("Add Student's", "AddStudent")

```

UpdateStudents.cshtml:-

```html
@model MVCWithLinq1.Models.Student
@{
    ViewBag.Title = "UpdateStudent";
}

<h2>UpdateStudent</h2>

@using (Html.BeginForm("UpdateStudent", "Student", FormMethod.Post, new { enctype ="multipart/form-data"}))
{
    <div>@Html.LabelFor(S => S.Sid)<br />@Html.TextBoxFor(S => S.Sid, new { @readOnly = true })</div>
    <div>@Html.LabelFor(S => S.Name)<br />@Html.TextBoxFor(S => S.Name)</div>
    <div>@Html.LabelFor(S => S.Class)<br />@Html.TextBoxFor(S => S.Class)</div>
    <div>@Html.LabelFor(S => S.Fees)<br />@Html.TextBoxFor(S => S.Fees)</div>
    <div>
        @Html.LabelFor(S => S.Photo)<br />
        <img src="~/Uploads/@Model.Photo" width="250px" height="250px" alt="@Model.Photo"/>
        <input type="file" name="selectedFile"/>
    </div>
    <div>
        <input type="submit" value="Update" />
    </div>
} 

@Html.ActionLink("Back to Student Details", "DisplayStudents")
```